<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Publish-Subscribe Broker for the Constrained Application Protocol (CoAP)</title>
<meta content="Michael Koster" name="author">
<meta content="Ari Keranen" name="author">
<meta content="Jaime JimÃ©nez" name="author">
<meta content="
       The Constrained Application Protocol (CoAP), and related extensions are intended
to support machine-to-machine communication in systems where one or more
nodes are resource constrained, in particular for low power wireless sensor
networks. This document defines a publish-subscribe Broker for CoAP that
extends the capabilities of CoAP for supporting nodes with long breaks in
connectivity and/or up-time. 
    " name="description">
<meta content="xml2rfc 2.40.1" name="generator">
<meta content="CoAP, PubSub" name="keyword">
<meta content="draft-ietf-core-coap-pubsub-latest" name="ietf.draft">
<link href="draft-ietf-core-pubsub.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@import url('https://martinthomson.github.io/i-d-template/fonts.css');

html {
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --small-font-size: 14.5px;
}
body {
  max-width: 624px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
#title {
  padding: 1em 0 0.2em;
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1, h2, h3 {
  font-size: 22px;
  line-height: 26px;
}
h4, h5, h6 {
  font-size: 18px;
  line-height: 22px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p, #abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 18px;
  line-height: 24px;
}
p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px 'Oxygen Mono', monospace;
}
pre {
  border: 1px solid var(--line-color);
  line-height: 17px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre {
    display: inline-block;
    overflow-x: auto;
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
  table {
    display: inline-block;
    overflow-x: auto;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #eee;
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  font-style: italic;
  margin: 0.3em 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  visibility: hidden;
  user-select: none;
}
a.pilcrow[href] { color: #ddd; }
a.pilcrow[href]:hover { text-decoration: none; }
@media screen {
  :hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    column-count: 2;
    column-gap: 20px;
  }
  .index ul ul {
    column-count: 1;
    column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 600px) {
  #authors-addresses > section {
    display: relative;
    padding: 32px 0 0;
    column-count: 2;
    column-gap: 20px;
  }
  #name-authors-address {
    position: absolute;
    top: 0px;
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #b76427;
  background-color: rgba(249, 232, 105, 0.3);
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: rgba(249, 232, 105, 0.3);
  border-radius: 3px;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 953px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 954px) {
  body {
    padding-right: 380px;
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Publish-Subscribe Broker for CoAP</td>
<td class="right">March 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Koster, et al.</td>
<td class="center">Expires 5 September 2020</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">CoRE</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-core-coap-pubsub-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-03-04" class="published">4 March 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2020-09-05">5 September 2020</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M.K. Koster</div>
<div class="org">SmartThings</div>
</div>
<div class="author">
      <div class="author-name">A.K. Keranen</div>
<div class="org">Ericsson</div>
</div>
<div class="author">
      <div class="author-name">J.J. JimÃ©nez</div>
<div class="org">Ericsson</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Publish-Subscribe Broker for the Constrained Application Protocol (CoAP)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The Constrained Application Protocol (CoAP), and related extensions are intended
to support machine-to-machine communication in systems where one or more
nodes are resource constrained, in particular for low power wireless sensor
networks. This document defines a publish-subscribe Broker for CoAP that
extends the capabilities of CoAP for supporting nodes with long breaks in
connectivity and/or up-time.<a href="#section-abstract-1" class="pilcrow">Â¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 5 September 2020.<a href="#section-boilerplate.1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">â²</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.Â Â <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.Â Â <a href="#name-terminology" class="xref">Terminology</a><a href="#section-toc.1-1.2.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.Â Â <a href="#name-architecture" class="xref">Architecture</a><a href="#section-toc.1-1.3.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.Â Â <a href="#name-coap-pub-sub-architecture" class="xref">CoAP Pub/sub Architecture</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.Â Â <a href="#name-coap-pub-sub-broker" class="xref">CoAP Pub/sub Broker</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.Â Â <a href="#name-coap-pub-sub-client" class="xref">CoAP Pub/sub Client</a><a href="#section-toc.1-1.3.2.3.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.Â Â <a href="#name-coap-pub-sub-topic" class="xref">CoAP Pub/sub Topic</a><a href="#section-toc.1-1.3.2.4.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.Â Â <a href="#name-brokerless-pub-sub" class="xref">Brokerless Pub/sub</a><a href="#section-toc.1-1.3.2.5.1" class="pilcrow">Â¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.Â Â <a href="#name-coap-pub-sub-rest-api" class="xref">CoAP Pub/sub REST API</a><a href="#section-toc.1-1.4.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.Â Â <a href="#name-discovery" class="xref">DISCOVERY</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.Â Â <a href="#name-create" class="xref">CREATE</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.Â Â <a href="#name-publish" class="xref">PUBLISH</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.Â Â <a href="#name-subscribe" class="xref">SUBSCRIBE</a><a href="#section-toc.1-1.4.2.4.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.Â Â <a href="#name-unsubscribe" class="xref">UNSUBSCRIBE</a><a href="#section-toc.1-1.4.2.5.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="xref">4.6</a>.Â Â <a href="#name-read" class="xref">READ</a><a href="#section-toc.1-1.4.2.6.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="xref">4.7</a>.Â Â <a href="#name-remove" class="xref">REMOVE</a><a href="#section-toc.1-1.4.2.7.1" class="pilcrow">Â¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.Â Â <a href="#name-coap-pub-sub-operation-with" class="xref">CoAP Pub/sub Operation with Resource Directory</a><a href="#section-toc.1-1.5.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.Â Â <a href="#name-sleep-wake-operation" class="xref">Sleep-Wake Operation</a><a href="#section-toc.1-1.6.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.Â Â <a href="#name-simple-flow-control" class="xref">Simple Flow Control</a><a href="#section-toc.1-1.7.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.Â Â <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.8.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.Â Â <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.9.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.Â Â <a href="#name-resource-type-value-coreps" class="xref">Resource Type value 'core.ps'</a><a href="#section-toc.1-1.9.2.1.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.Â Â <a href="#name-resource-type-value-corepsd" class="xref">Resource Type value 'core.ps.discover'</a><a href="#section-toc.1-1.9.2.2.1" class="pilcrow">Â¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>.Â <a href="#name-acknowledgements" class="xref">Acknowledgements</a><a href="#section-toc.1-1.10.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>.Â <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.11.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.Â Â <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.11.2.1.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.Â Â <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.11.2.2.1" class="pilcrow">Â¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.12.1" class="pilcrow">Â¶</a></p>
</li>
</ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The Constrained Application Protocol (CoAP) <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> supports
machine-to-machine communication across networks of constrained
devices. CoAP uses a request/response model where clients make requests to
servers in order to request actions on resources. Depending on the situation
the same device may act either as a server, a client, or both.<a href="#section-1-1" class="pilcrow">Â¶</a></p>
<p id="section-1-2">One important class of constrained devices includes devices that are intended
to run for years from a small battery, or by scavenging energy from their
environment. These devices have limited reachability because they spend most
of their time in a sleeping state with no network connectivity. Devices may
also have limited reachability due to certain middle-boxes, such as Network
Address Translators (NATs) or firewalls. Such middle-boxes often prevent
connecting to a device from the Internet unless the connection was initiated
by the device.<a href="#section-1-2" class="pilcrow">Â¶</a></p>
<p id="section-1-3">For some applications the client/server and request/response communication model
is not optimal but publish-subscribe communication with potentially many senders
and/or receivers and communication via topics rather than directly with
endpoints may fit better.<a href="#section-1-3" class="pilcrow">Â¶</a></p>
<p id="section-1-4">This document specifies simple extensions to CoAP for enabling publish-subscribe
communication using a Broker node that enables store-and-forward messaging
between two or more nodes. This model facilitates communication of nodes with
limited reachability, enables simple many-to-many communication, and eases
integration with other publish-subscribe systems.<a href="#section-1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCPÂ 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">Â¶</a></p>
<p id="section-2-2">This specification requires readers to be familiar with all the terms and
concepts that are discussed in <span>[<a href="#RFC5988" class="xref">RFC5988</a>]</span> and <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span>. Readers
should also be familiar with the terms and concepts discussed in
<span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> and <span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span>. The URI template
format <span>[<a href="#RFC6570" class="xref">RFC6570</a>]</span> is used to describe the REST API defined in
this specification.<a href="#section-2-2" class="pilcrow">Â¶</a></p>
<p id="section-2-3">This specification makes use of the following additional terminology:<a href="#section-2-3" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-2-4">
        <dt id="section-2-4.1">Publish-Subscribe (pub/sub):</dt>
<dd id="section-2-4.2">
  A messaging paradigm where messages are published to a Broker and potential
receivers can subscribe to the Broker to receive messages. The publishers
do not (need to) know where the message will be eventually sent: the publications
and subscriptions are matched by a Broker and publications are delivered
by the Broker to subscribed receivers.<a href="#section-2-4.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-2-4.3">CoAP pub/sub service:</dt>
<dd id="section-2-4.4">
  A group of REST resources, as defined in this document, which together
implement the required features of this specification.<a href="#section-2-4.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-2-4.5">CoAP pub/sub Broker:</dt>
<dd id="section-2-4.6">
  A server node capable of receiving messages (publications) from and sending
messages to other nodes, and able to match subscriptions and publications
in order to route messages to the right destinations. The Broker can also
temporarily store publications to satisfy future subscriptions and pending notifications.<a href="#section-2-4.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-2-4.7">CoAP pub/sub Client:</dt>
<dd id="section-2-4.8">
  A CoAP client which is capable of publish or subscribe operations as defined
in this specification.<a href="#section-2-4.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-2-4.9">Topic:</dt>
<dd id="section-2-4.10">
  A unique identifier for a particular item being published and/or subscribed
to. A Broker uses the topics to match subscriptions to publications. A reference to a Topic on a Broker 
is a valid CoAP URI as defined in <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span><a href="#section-2-4.10" class="pilcrow">Â¶</a>
</dd>
</dl>
</section>
</div>
<div id="architecture">
<section id="section-3">
      <h2 id="name-architecture">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-architecture" class="section-name selfRef">Architecture</a>
      </h2>
<div id="coap-pubsub-architecture">
<section id="section-3.1">
        <h3 id="name-coap-pub-sub-architecture">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-coap-pub-sub-architecture" class="section-name selfRef">CoAP Pub/sub Architecture</a>
        </h3>
<p id="section-3.1-1"><a href="#arch-fig" class="xref">Figure 1</a> shows the architecture of a CoAP pub/sub service. CoAP pub/sub Clients interact
with a CoAP pub/sub Broker through the CoAP pub/sub REST API which is hosted by
the Broker. State information is updated between the Clients and the Broker.
The CoAP pub/sub Broker performs a store-and-forward of state update representations
between certain CoAP pub/sub Clients. Clients Subscribe to topics upon which
representations are Published by other Clients, which are forwarded by the
Broker to the subscribing clients. A CoAP pub/sub Broker may be used as a
REST resource proxy, retaining the last published representation to supply
in response to Read requests from Clients.<a href="#section-3.1-1" class="pilcrow">Â¶</a></p>
<span id="name-coap-pub-sub-architecture-2"></span><div id="arch-fig">
<figure id="figure-1">
          <div class="artwork art-text alignCenter" id="section-3.1-2.1">
<pre>
Clients        pub/sub         Broker
+-------+         |
| CoAP  |         |
|pub/sub|---------|------+
|Client |         |      |    +-------+
+-------+         |      +----| CoAP  |
                  |           |pub/sub|
+-------+         |      +----|Broker |
| CoAP  |         |      |    +-------+
|pub/sub|---------|------+
|Client |         |
+-------+         |

</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-coap-pub-sub-architecture-2" class="selfRef">CoAP pub/sub Architecture</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="coap-pubsub-broker">
<section id="section-3.2">
        <h3 id="name-coap-pub-sub-broker">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-coap-pub-sub-broker" class="section-name selfRef">CoAP Pub/sub Broker</a>
        </h3>
<p id="section-3.2-1">A CoAP pub/sub Broker is a CoAP Server that exposes a REST API for clients
to use to initiate publish-subscribe interactions. Avoiding the need
for direct reachability between clients, the Broker only needs to be
reachable from all clients. The Broker also needs to have sufficient
resources (storage, bandwidth, etc.) to host CoAP resource services,
and potentially buffer messages, on behalf of the clients.<a href="#section-3.2-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="coap-pubsub-client">
<section id="section-3.3">
        <h3 id="name-coap-pub-sub-client">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-coap-pub-sub-client" class="section-name selfRef">CoAP Pub/sub Client</a>
        </h3>
<p id="section-3.3-1">A CoAP pub/sub Client interacts with a CoAP pub/sub Broker using the CoAP pub/sub
REST API defined in this document. Clients initiate interactions with a CoAP pub/sub Broker. A data source
(e.g., sensor clients) can publish state updates to the Broker and data sinks
(e.g., actuator clients) can read from or subscribe to state updates from
the Broker. Application clients can make use of both publish and subscribe
in order to exchange state updates with data sources and data sinks.<a href="#section-3.3-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="coap-pubsub-topic">
<section id="section-3.4">
        <h3 id="name-coap-pub-sub-topic">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-coap-pub-sub-topic" class="section-name selfRef">CoAP Pub/sub Topic</a>
        </h3>
<p id="section-3.4-1">The clients and Broker use topics to identify a particular resource or
object in a publish-subscribe system. Topics are conventionally formed
as a hierarchy, e.g. "/sensors/weather/barometer/pressure" or
"/EP-33543/sen/3303/0/5700".  The topics are hosted by a Broker and
all the clients using the Broker share the same namespace for
topics.<a href="#section-3.4-1" class="pilcrow">Â¶</a></p>
<p id="section-3.4-2">Every CoAP pub/sub topic has an associated link, consisting of a reference
path on the Broker using URI path <span>[<a href="#RFC3986" class="xref">RFC3986</a>]</span> construction and link
attributes <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span>. Every topic is associated with zero or more
stored representations and a content-format specified in the link. A
CoAP pub/sub topic value may alternatively consist of a collection of one or
more sub-topics, consisting of links to the sub-topic URIs and
indicated by a link-format content-format. Sub-topics are also topics and
may have their own sub-topics, forming a tree structure of unique paths that
is implemented using URIs. The full URI of a topic includes a scheme and 
authority for the Broker, for example 
"coaps://192.0.2.13:5684/EP-33543/sen/3303/0/5700".<a href="#section-3.4-2" class="pilcrow">Â¶</a></p>
<p id="section-3.4-3">A Topic may have a lifetime defined by using the CoAP Max-Age option on topic 
creation, or on publish operations to the topic. The lifetime is refreshed each 
time a representation is published to the topic. If the lifetime expires, the 
topic is removed from discovery responses, returns errors on subscription, and 
any outstanding subscriptions are cancelled.<a href="#section-3.4-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="brokerless-pubsub">
<section id="section-3.5">
        <h3 id="name-brokerless-pub-sub">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-brokerless-pub-sub" class="section-name selfRef">Brokerless Pub/sub</a>
        </h3>
<p id="section-3.5-1">In some use cases, it is desireable to use pub/sub semantics for peer-to-peer 
communication, but it is not feasible or desireable to include a separate node 
on the network to serve as a Broker. In other use cases, it is desireable to enable one-way-only communication, such as sensors pushing updates to a service.<a href="#section-3.5-1" class="pilcrow">Â¶</a></p>
<p id="section-3.5-2"><a href="#brokerless" class="xref">Figure 2</a> shows an arrangement for using CoAP pub/sub in a
"Brokerless" configuration between peer nodes. Nodes in a Brokerless
system may act as both Broker and client. A node that supports Broker
functionality may be pre-configured with topics that expose services
and resources. Brokerless peer nodes can be mixed with client and
Broker nodes in a system with full interoperability.<a href="#section-3.5-2" class="pilcrow">Â¶</a></p>
<span id="name-brokerless-pub-sub-2"></span><div id="brokerless">
<figure id="figure-2">
          <div class="artwork art-text alignCenter" id="section-3.5-3.1">
<pre>
  Peer         pub/sub          Peer
+-------+         |         +-------+
| CoAP  |         |         | CoAP  |
|pub/sub|---------|---------|pub/sub|
|Client |         |         |Broker |
+-------+         |         +-------+
| CoAP  |         |         | CoAP  |
|pub/sub|---------|---------|pub/sub|
|Broker |         |         |Client |
+-------+         |         +-------+

</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-brokerless-pub-sub-2" class="selfRef">Brokerless pub/sub</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="sec-rest-api">
<section id="section-4">
      <h2 id="name-coap-pub-sub-rest-api">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-coap-pub-sub-rest-api" class="section-name selfRef">CoAP Pub/sub REST API</a>
      </h2>
<p id="section-4-1">This section defines the REST API exposed by a CoAP pub/sub Broker to pub/sub
Clients.  The examples throughout this section assume the use of CoAP
<span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>. A CoAP pub/sub Broker implementing this specification SHOULD
support the DISCOVERY, CREATE, PUBLISH, SUBSCRIBE, UNSUBSCRIBE, READ,
and REMOVE operations defined in this section. Optimized implementations
MAY support a subset of the operations as required by particular constrained
use cases.<a href="#section-4-1" class="pilcrow">Â¶</a></p>
<div id="discover">
<section id="section-4.1">
        <h3 id="name-discovery">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-discovery" class="section-name selfRef">DISCOVERY</a>
        </h3>
<p id="section-4.1-1">CoAP pub/sub Clients discover CoAP pub/sub Brokers by using CoAP Simple
Discovery or through a Resource Directory (RD)
<span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span>. A CoAP pub/sub Broker SHOULD
indicate its presence and availability on a network by exposing a link
to the entry point of its pub/sub API at its .well-known/core location <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span>. A CoAP
pub/sub Broker MAY register its pub/sub REST API entry point with a Resource
Directory. <a href="#discover-fig" class="xref">Figure 3</a> shows an example of a client discovering a
local pub/sub API using CoAP Simple Discovery. A Broker wishing to
advertise the CoAP pub/sub API for Simple Discovery or through a
Resource Directory MUST use the link relation rt=core.ps. A Broker MAY
advertise its supported content formats and other attributes in the
link to its pub/sub API.<a href="#section-4.1-1" class="pilcrow">Â¶</a></p>
<p id="section-4.1-2">A CoAP pub/sub Broker MAY offer a topic discovery entry point to enable Clients
to find topics of interest, either by topic name or by link attributes
which may be registered when the topic is
created. <a href="#discover-topic-fig" class="xref">Figure 4</a> shows an example of a client looking
for a topic with a resource type (rt) of "temperature" using
Discover. The client then receives the URI of the resource and its
content-format. A pub/sub Broker wishing to advertise topic discovery
MUST use the relation rt=core.ps.discover in the link.<a href="#section-4.1-2" class="pilcrow">Â¶</a></p>
<p id="section-4.1-3">A CoAP pub/sub Broker MAY provide topic discovery functionality through the
.well-known/core resource. Links to topics may be exposed at
.well-known/core in addition to links to the pub/sub
API. <a href="#discover-topic-wk-fig" class="xref">Figure 5</a> shows an example of topic discovery
through .well-known/core.<a href="#section-4.1-3" class="pilcrow">Â¶</a></p>
<p id="section-4.1-4">Topics in the broker may be created in hierarchies (see <a href="#sec-create" class="xref">Section 4.2</a>) with
parent topics having sub-topics. For a discovery the broker may choose
to not expose the sub-topics in order to limit amount of topic links
sent in a discovery response. The client can then perform discovery
for the parent topics it wants to discover the sub-topics.<a href="#section-4.1-4" class="pilcrow">Â¶</a></p>
<p id="section-4.1-5">The DISCOVER interface is specified as follows:<a href="#section-4.1-5" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.1-6">
          <dt id="section-4.1-6.1">Interaction:</dt>
<dd id="section-4.1-6.2">
  Client -&gt; Broker<a href="#section-4.1-6.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.1-6.3">Method:</dt>
<dd id="section-4.1-6.4">
  GET<a href="#section-4.1-6.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.1-6.5">URI Template:</dt>
<dd id="section-4.1-6.6">
  {+ps}/{+topic}{?q*}<a href="#section-4.1-6.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.1-6.7">URI Template Variables:</dt>
<dd id="section-4.1-6.8">
  ps := Pub/sub REST API entry point (optional). The entry point of the pub/sub REST API, as obtained from discovery, used to discover topics.<a href="#section-4.1-6.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.1-6.9"></dt>
<dd id="section-4.1-6.10">topic := The desired topic to return links for (optional).<a href="#section-4.1-6.10" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.1-6.11"></dt>
<dd id="section-4.1-6.12">q := Query Filter (optional). MAY contain a query filter list as per
 <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span> Section 4.1.<a href="#section-4.1-6.12" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.1-6.13">Content-Format:</dt>
<dd id="section-4.1-6.14">
  application/link-format<a href="#section-4.1-6.14" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.1-7">The following response codes are defined for the DISCOVER operation:<a href="#section-4.1-7" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.1-8">
          <dt id="section-4.1-8.1">Success:</dt>
<dd id="section-4.1-8.2">
  2.05 "Content" with an application/link-format payload containing
one or more matching entries for the Broker resource. A pub/sub
Broker SHOULD use the value "/ps/" for the base URI of the pub/sub
API wherever possible.<a href="#section-4.1-8.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.1-8.3">Failure:</dt>
<dd id="section-4.1-8.4">
  4.04 "Not Found" is returned in case no matching entry is found for
a unicast request.<a href="#section-4.1-8.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.1-8.5">Failure:</dt>
<dd id="section-4.1-8.6">
  4.00 "Bad Request" is returned in case of a malformed request for a unicast
request.<a href="#section-4.1-8.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.1-8.7">Failure:</dt>
<dd id="section-4.1-8.8">
  No error response to a multicast request.<a href="#section-4.1-8.8" class="pilcrow">Â¶</a>
</dd>
</dl>
<span id="name-example-of-discover-pub-sub"></span><div id="discover-fig">
<figure id="figure-3">
          <div class="artwork art-text alignCenter" id="section-4.1-9.1">
<pre>
Client                                          Broker
  |                                               |
  | ------ GET /.well-known/core?rt=core.ps ----&gt;&gt;|
  | -- Content-Format: application/link-format ---|
  |                                               |
  | &lt;&lt;--- 2.05 Content                            |
  | &lt;/ps/&gt;;rt=core.ps;rt=core.ps.discover;ct=40 --|
  |                                               |

</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-example-of-discover-pub-sub" class="selfRef">Example of DISCOVER pub/sub function</a>
          </figcaption></figure>
</div>
<span id="name-example-of-discover-topic"></span><div id="discover-topic-fig">
<figure id="figure-4">
          <div class="artwork art-text alignCenter" id="section-4.1-10.1">
<pre>
Client                                          Broker
  |                                               |
  | ---------- GET /ps/?rt="temperature" -------&gt;&gt;|
  |    Content-Format: application/link-format    |
  |                                               |
  | &lt;&lt;-- 2.05 Content                             |
  |   &lt;/ps/currentTemp&gt;;rt="temperature";ct=50 ---|
  |                                               |

</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-example-of-discover-topic" class="selfRef">Example of DISCOVER topic</a>
          </figcaption></figure>
</div>
<span id="name-example-of-discover-topic-2"></span><div id="discover-topic-wk-fig">
<figure id="figure-5">
          <div class="artwork art-text alignCenter" id="section-4.1-11.1">
<pre>
Client                                          Broker
  |                                               |
  | -------- GET /.well-known/core?ct=50 -------&gt;&gt;|
  |    Content-Format: application/link-format    |
  |                                               |
  | &lt;&lt;-- 2.05 Content                             |
  |   &lt;/ps/currentTemp&gt;;rt="temperature";ct=50 ---|
  |                                               |

</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-example-of-discover-topic-2" class="selfRef">Example of DISCOVER topic</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-create">
<section id="section-4.2">
        <h3 id="name-create">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-create" class="section-name selfRef">CREATE</a>
        </h3>
<p id="section-4.2-1">A CoAP pub/sub broker SHOULD allow Clients to create new topics on the
broker using CREATE. Some exceptions are for fixed brokerless devices
and pre-configured brokers in dedicated installations. A client wishing
to create a topic MUST use a CoAP POST to the pub/sub API with a payload
indicating the desired topic. The topic specification sent in the
payload MUST use a supported serialization of the CoRE link format
<span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span>. The target of the link MUST be a URI formatted
string. The client MUST indicate the desired content format for
publishes to the topic by using the ct (Content Format) link attribute
in the link-format payload. Additional link target attributes and relation
values MAY be included in the topic specification link when a topic is created.<a href="#section-4.2-1" class="pilcrow">Â¶</a></p>
<p id="section-4.2-2">The client MAY indicate the lifetime of the topic by including the Max-Age
option in the CREATE request.<a href="#section-4.2-2" class="pilcrow">Â¶</a></p>
<p id="section-4.2-3">Topic hierarchies can be created by creating parent topics. A parent
topic is created with a POST using ct (Content Format) link attribute
value which describes a supported serialization of the CoRE link
format <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span>, such as application/link-format (ct=40) or its
JSON or CBOR serializations.  If a topic is created which describes a
link serialization, that topic may then have sub-topics created under
it as shown in <a href="#create-sub-fig" class="xref">Figure 7</a>.<a href="#section-4.2-3" class="pilcrow">Â¶</a></p>
<p id="section-4.2-4">Ony one level in the topic hierarchy may be created as a result of a CREATE
operation, unless create on PUBLISH is supported (see <a href="#sec-publish" class="xref">Section 4.3</a>).
The topic string used in the link target MUST NOT contain the "/" character.<a href="#section-4.2-4" class="pilcrow">Â¶</a></p>
<p id="section-4.2-5">A topic creator MUST include exactly one content format link attribute value (ct) in the create payload. If the content format option is not included or if the option is repeated, the Broker MUST reject the operation with an error code of "4.00 Bad Request".<a href="#section-4.2-5" class="pilcrow">Â¶</a></p>
<p id="section-4.2-6">Only one topic may be created per request. If there is more than one link 
included in a CREATE request, the Broker MUST reject the operation with an
error code of "4.00 Bad Request".<a href="#section-4.2-6" class="pilcrow">Â¶</a></p>
<p id="section-4.2-7">A Broker MUST return a response code of "2.01 Created" if the topic is
created and MUST return the URI path of the created topic via Location-Path
options. If a new topic can not be created, the Broker MUST return the appropriate 4.xx response code indicating the reason for failure.<a href="#section-4.2-7" class="pilcrow">Â¶</a></p>
<p id="section-4.2-8">A Broker SHOULD remove topics if the Max-Age of the topic is
exceeded without any publishes to the topic.  A Broker SHOULD retain a
topic indefinitely if the Max-Age option is elided or is set to zero
upon topic creation. The lifetime of a topic MUST be refreshed upon
create operations with a target of an existing topic.<a href="#section-4.2-8" class="pilcrow">Â¶</a></p>
<p id="section-4.2-9">A topic creator SHOULD PUBLISH an initial value to a newly-created Topic in order to enable responses to READ and SUBSCRIBE requests that may be submitted after the topic is discoverable.<a href="#section-4.2-9" class="pilcrow">Â¶</a></p>
<p id="section-4.2-10">The CREATE interface is specified as follows:<a href="#section-4.2-10" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.2-11">
          <dt id="section-4.2-11.1">Interaction:</dt>
<dd id="section-4.2-11.2">
  Client -&gt; Broker<a href="#section-4.2-11.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.2-11.3">Method:</dt>
<dd id="section-4.2-11.4">
  POST<a href="#section-4.2-11.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.2-11.5">URI Template:</dt>
<dd id="section-4.2-11.6">
  {+ps}/{+topic}<a href="#section-4.2-11.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.2-11.7">URI Template Variables:</dt>
<dd id="section-4.2-11.8">
  ps := Pub/sub REST API entry point (optional). The entry point of the pub/sub REST API, as obtained from discovery, used to discover topics.<a href="#section-4.2-11.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.2-11.9"></dt>
<dd id="section-4.2-11.10">topic := The desired topic to return links for (optional).<a href="#section-4.2-11.10" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.2-11.11">Content-Format:</dt>
<dd id="section-4.2-11.12">
  application/link-format<a href="#section-4.2-11.12" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.2-11.13">Payload:</dt>
<dd id="section-4.2-11.14">
  The desired topic to CREATE<a href="#section-4.2-11.14" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.2-12">The following response codes are defined for the CREATE operation:<a href="#section-4.2-12" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.2-13">
          <dt id="section-4.2-13.1">Success:</dt>
<dd id="section-4.2-13.2">
  2.01 "Created". Successful Creation of the topic<a href="#section-4.2-13.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.2-13.3">Failure:</dt>
<dd id="section-4.2-13.4">
  4.00 "Bad Request". Malformed request.<a href="#section-4.2-13.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.2-13.5">Failure:</dt>
<dd id="section-4.2-13.6">
  4.01 "Unauthorized". Authorization failure.<a href="#section-4.2-13.6" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.2-14"><a href="#create-fig" class="xref">Figure 6</a> shows an example of a topic called "topic1" being
successfully created.<a href="#section-4.2-14" class="pilcrow">Â¶</a></p>
<span id="name-example-of-create-topic"></span><div id="create-fig">
<figure id="figure-6">
          <div class="artwork art-text alignCenter" id="section-4.2-15.1">
<pre>
Client                                          Broker
  |                                               |
  | ---------- POST /ps/ "&lt;topic1&gt;;ct=50" -------&gt;|
  |                                               |
  | &lt;---------------- 2.01 Created ---------------|
  |               Location: /ps/topic1            |
  |                                               |

</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-example-of-create-topic" class="selfRef">Example of CREATE topic</a>
          </figcaption></figure>
</div>
<span id="name-example-of-create-of-topic-"></span><div id="create-sub-fig">
<figure id="figure-7">
          <div class="artwork art-text alignCenter" id="section-4.2-16.1">
<pre>
Client                                          Broker
  |                                               |
  | ----- POST /ps/ "&lt;parent-topic&gt;;ct=40" ------&gt;|
  |                                               |
  | &lt;---------------- 2.01 Created ---------------|
  |            Location: /ps/parent-topic/        |
  |                                               |
  |-- POST /ps/parent-topic/ "&lt;subtopic&gt;;ct=50" -&gt;|
  |                                               |
  | &lt;---------------- 2.01 Created ---------------|
  |       Location: /ps/parent-topic/subtopic     |
  |                                               |
  |                                               |

</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-example-of-create-of-topic-" class="selfRef">Example of CREATE of topic hierarchy</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="sec-publish">
<section id="section-4.3">
        <h3 id="name-publish">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-publish" class="section-name selfRef">PUBLISH</a>
        </h3>
<p id="section-4.3-1">A CoAP pub/sub Broker MAY allow clients to PUBLISH to topics on
the Broker. A client MAY use the PUT or the POST method to publish
state updates to the CoAP pub/sub Broker. A client MUST use the content
format specified upon creation of a given topic to publish updates to
that topic. The Broker MUST reject publish operations which do not use
the specified content format.  A CoAP client publishing on a topic MAY
indicate the maximum lifetime of the value by including the Max-Age
option in the publish request. The Broker MUST return a response code
of "2.04 Changed" if the publish is accepted.  A Broker MAY return a
"4.04 Not Found" if the topic does not exist. A Broker MAY return
"4.29 Too Many Requests" if simple flow control as described in
<a href="#sec-flow-control" class="xref">Section 7</a> is implemented.<a href="#section-4.3-1" class="pilcrow">Â¶</a></p>
<p id="section-4.3-2">A Broker MUST accept PUBLISH operations using the PUT method. PUBLISH
operations using the PUT method replace any stored representation
associated with the topic, with the supplied representation. A Broker
MAY reject, or delay responses to, PUT requests to a topic while
pending resolution of notifications to subscribers from previous PUT
requests.<a href="#section-4.3-2" class="pilcrow">Â¶</a></p>
<p id="section-4.3-3">Create on PUBLISH: A Broker MAY accept PUBLISH operations to new topics using
the PUT method. If a Broker accepts a PUBLISH using PUT to a topic that does
not exist, the Broker MUST create the topic using the information in the
PUT operation. The Broker MUST create a topic with the URI-Path of the request,
including all of the sub-topics necessary, and create a topic link with the
ct attribute set to the content-format value from the header of the PUT request.
If topic is created, the Broker MUST return the response "2.01 Created" with
the URI of the created topic, including all of the created path segments,
returned via the Location-Path option.<a href="#section-4.3-3" class="pilcrow">Â¶</a></p>
<p id="section-4.3-4"><a href="#create-publish-fig" class="xref">Figure 9</a> shows an example of a topic being created on first
PUBLISH.<a href="#section-4.3-4" class="pilcrow">Â¶</a></p>
<p id="section-4.3-5">A Broker MAY accept PUBLISH operations using the POST method. If a
Broker accepts PUBLISH using POST it shall respond with the 2.04 Changed
status code. If an attempt is made to PUBLISH using POST to a topic that does
not exist, the Broker SHALL return a response status indicating resource not
found, such as HTTP 404 or CoAP 4.04.<a href="#section-4.3-5" class="pilcrow">Â¶</a></p>
<p id="section-4.3-6">A Broker MAY perform garbage collection of stored representations
which have been delivered to all subscribers or which have timed
out. A Broker MAY retain at least one most recently published
representation to return in response to SUBSCRIBE and READ requests.<a href="#section-4.3-6" class="pilcrow">Â¶</a></p>
<p id="section-4.3-7">A Broker MUST make a best-effort attempt to notify all clients
subscribed on a particular topic each time it receives a publish on
that topic. An example is shown in <a href="#subscribe-fig" class="xref">Figure 10</a>.<a href="#section-4.3-7" class="pilcrow">Â¶</a></p>
<p id="section-4.3-8">If a client publishes to a Broker without the Max-Age option, the Broker MUST
refresh the topic lifetime with the most recently set Max-Age value, and the 
Broker MUST include the most recently set Max-Age value in the Max-Age option of 
all notifications.<a href="#section-4.3-8" class="pilcrow">Â¶</a></p>
<p id="section-4.3-9">If a client publishes to a Broker with the Max-Age option, the Broker MUST
include the same value for the Max-Age option in all notifications.<a href="#section-4.3-9" class="pilcrow">Â¶</a></p>
<p id="section-4.3-10">A Broker MUST use CoAP Notification as described in <span>[<a href="#RFC7641" class="xref">RFC7641</a>]</span> to notify
subscribed clients.<a href="#section-4.3-10" class="pilcrow">Â¶</a></p>
<p id="section-4.3-11">The PUBLISH operation is specified as follows:<a href="#section-4.3-11" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.3-12">
          <dt id="section-4.3-12.1">Interaction:</dt>
<dd id="section-4.3-12.2">
  Client -&gt; Broker<a href="#section-4.3-12.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.3-12.3">Method:</dt>
<dd id="section-4.3-12.4">
  PUT, POST<a href="#section-4.3-12.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.3-12.5">URI Template:</dt>
<dd id="section-4.3-12.6">
  {+ps}/{+topic}<a href="#section-4.3-12.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.3-12.7">URI Template Variables:</dt>
<dd id="section-4.3-12.8">
  ps := Pub/sub REST API entry point (optional). The entry point of the pub/sub REST API, as obtained from discovery, used to discover topics.<a href="#section-4.3-12.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.3-12.9"></dt>
<dd id="section-4.3-12.10">topic := The desired topic to return links for (optional).<a href="#section-4.3-12.10" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.3-12.11">Content-Format:</dt>
<dd id="section-4.3-12.12">
  Any valid CoAP content format<a href="#section-4.3-12.12" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.3-12.13">Payload:</dt>
<dd id="section-4.3-12.14">
  Representation of the topic value (CoAP resource state representation) in
the indicated content format<a href="#section-4.3-12.14" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.3-13">The following response codes are defined for the PUBLISH operation:<a href="#section-4.3-13" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.3-14">
          <dt id="section-4.3-14.1">Success:</dt>
<dd id="section-4.3-14.2">
  2.01 "Created". Successful publish, topic is created<a href="#section-4.3-14.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.3-14.3">Success:</dt>
<dd id="section-4.3-14.4">
  2.04 "Changed". Successful publish, topic is updated<a href="#section-4.3-14.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.3-14.5">Failure:</dt>
<dd id="section-4.3-14.6">
  4.00 "Bad Request". Malformed request.<a href="#section-4.3-14.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.3-14.7">Failure:</dt>
<dd id="section-4.3-14.8">
  4.01 "Unauthorized". Authorization failure.<a href="#section-4.3-14.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.3-14.9">Failure:</dt>
<dd id="section-4.3-14.10">
  4.04 "Not Found". Topic does not exist.<a href="#section-4.3-14.10" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.3-14.11">Failure:</dt>
<dd id="section-4.3-14.12">
  4.29 "Too Many Requests". The client should slow down the rate of publish
messages for this topic (see <a href="#sec-flow-control" class="xref">Section 7</a>).<a href="#section-4.3-14.12" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.3-15"><a href="#publish-fig" class="xref">Figure 8</a> shows an example of a new value being successfully
published to the topic "topic1". See <a href="#subscribe-fig" class="xref">Figure 10</a> for an example
of a Broker forwarding a message from a publishing client to a
subscribed client.<a href="#section-4.3-15" class="pilcrow">Â¶</a></p>
<span id="name-example-of-publish"></span><div id="publish-fig">
<figure id="figure-8">
          <div class="artwork art-text alignCenter" id="section-4.3-16.1">
<pre>
Client                                          Broker
  |                                               |
  | ---------- PUT /ps/topic1 "1033.3"  --------&gt; |
  |                                               |
  |                                               |
  | &lt;--------------- 2.04 Changed---------------- |
  |                                               |

</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-example-of-publish" class="selfRef">Example of PUBLISH</a>
          </figcaption></figure>
</div>
<span id="name-example-of-create-on-publis"></span><div id="create-publish-fig">
<figure id="figure-9">
          <div class="artwork art-text alignCenter" id="section-4.3-17.1">
<pre>
Client                                          Broker
  |                                               |
  | -------- PUT /ps/exa/mpl/e "1033.3"  -------&gt; |
  |                                               |
  |                                               |
  | &lt;--------------- 2.01 Created---------------- |
  |             Location: /ps/exa/mpl/e           |
  |                                               |

</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-example-of-create-on-publis" class="selfRef">Example of CREATE on PUBLISH</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="subscribe">
<section id="section-4.4">
        <h3 id="name-subscribe">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-subscribe" class="section-name selfRef">SUBSCRIBE</a>
        </h3>
<p id="section-4.4-1">A CoAP pub/sub Broker MAY allow Clients to subscribe to topics on the Broker
using CoAP Observe as described in <span>[<a href="#RFC7641" class="xref">RFC7641</a>]</span>. A CoAP pub/sub Client wishing
to Subscribe to a topic on a Broker MUST use a CoAP GET with the Observe
option set to 0 (zero). The Broker MAY add the client to a
list of observers. The Broker MUST return a response code of "2.05 Content"
along with the most recently published value if the topic contains a valid
value and the Broker can supply the requested content format. The Broker
MUST reject Subscribe requests on a topic if the content format of the request
is not the content format the topic was created with.<a href="#section-4.4-1" class="pilcrow">Â¶</a></p>
<p id="section-4.4-2">If the topic was published with the Max-Age option, the Broker MUST set the Max-Age option in the valid response to the amount of time remaining for the value to be valid since the last publish operation on that topic.<a href="#section-4.4-2" class="pilcrow">Â¶</a></p>
<p id="section-4.4-3">The Broker MUST return a response code "4.04 Not Found" if the topic does not 
exist or has been removed, or if Max-Age of a previously published 
representation has expired.<a href="#section-4.4-3" class="pilcrow">Â¶</a></p>
<p id="section-4.4-4">If a Topic has been created but not yet published to when a SUBSCRIBE to the 
topic is received, the Broker MAY acknowledge and queue the pending SUBSCRIBE 
and defer the response until an initial PUBLISH occurs.<a href="#section-4.4-4" class="pilcrow">Â¶</a></p>
<p id="section-4.4-5">The Broker MUST return a response code "4.15 Unsupported Content Format" if it 
can not return the requested content format. If a Broker is unable to accept a 
new Subscription on a topic, it SHOULD return the appropriate response code 
without the Observe option as per <span>[<a href="#RFC7641" class="xref">RFC7641</a>]</span> Section 4.1.<a href="#section-4.4-5" class="pilcrow">Â¶</a></p>
<p id="section-4.4-6">There is no explicit maximum lifetime of a Subscription, thus a Broker may 
remove subscribers at any time. The Broker, upon removing a Subscriber, will 
transmit the appropriate response code without the Observe option, as per 
<span>[<a href="#RFC7641" class="xref">RFC7641</a>]</span> Section 4.2, to the removed Subscriber.<a href="#section-4.4-6" class="pilcrow">Â¶</a></p>
<p id="section-4.4-7">The SUBSCRIBE operation is specified as follows:<a href="#section-4.4-7" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.4-8">
          <dt id="section-4.4-8.1">Interaction:</dt>
<dd id="section-4.4-8.2">
  Client -&gt; Broker<a href="#section-4.4-8.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.4-8.3">Method:</dt>
<dd id="section-4.4-8.4">
  GET<a href="#section-4.4-8.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.4-8.5">Options:</dt>
<dd id="section-4.4-8.6">
  Observe:0<a href="#section-4.4-8.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.4-8.7">URI Template:</dt>
<dd id="section-4.4-8.8">
  {+ps}/{+topic}<a href="#section-4.4-8.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.4-8.9">URI Template Variables:</dt>
<dd id="section-4.4-8.10">
  ps := Pub/sub REST API entry point (optional). The entry point of the pub/sub REST API, as obtained from discovery, used to discover topics.<a href="#section-4.4-8.10" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.4-8.11"></dt>
<dd id="section-4.4-8.12">topic := The desired topic to return links for (optional).<a href="#section-4.4-8.12" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.4-9">The following response codes are defined for the SUBSCRIBE operation:<a href="#section-4.4-9" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.4-10">
          <dt id="section-4.4-10.1">Success:</dt>
<dd id="section-4.4-10.2">
  2.05 "Content". Successful subscribe, current value included<a href="#section-4.4-10.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.4-10.3">Failure:</dt>
<dd id="section-4.4-10.4">
  4.00 "Bad Request". Malformed request.<a href="#section-4.4-10.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.4-10.5">Failure:</dt>
<dd id="section-4.4-10.6">
  4.01 "Unauthorized". Authorization failure.<a href="#section-4.4-10.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.4-10.7">Failure:</dt>
<dd id="section-4.4-10.8">
  4.04 "Not Found". Topic does not exist.<a href="#section-4.4-10.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.4-10.9">Failure:</dt>
<dd id="section-4.4-10.10">
  4.15 "Unsupported Content Format". Unsupported content format.<a href="#section-4.4-10.10" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.4-11"><a href="#subscribe-fig" class="xref">Figure 10</a> shows an example of Client2 subscribing to "topic1"
and receiving a response from the Broker, with a subsequent
notification. The subscribe response from the Broker uses the last
stored value associated with the topic1. The notification from the
Broker is sent in response to the publish received from Client1.<a href="#section-4.4-11" class="pilcrow">Â¶</a></p>
<span id="name-example-of-subscribe"></span><div id="subscribe-fig">
<figure id="figure-10">
          <div class="artwork art-text alignCenter" id="section-4.4-12.1">
<pre>
Client1   Client2                                          Broker
  |          |                   Subscribe                   |
  |          | ----- GET /ps/topic1 Observe:0 Token:XX ----&gt; |
  |          |                                               |
  |          | &lt;---------- 2.05 Content Observe:10---------- |
  |          |                                               |
  |          |                                               |
  |          |                    Publish                    |
  | ---------|----------- PUT /ps/topic1 "1033.3"  --------&gt; |
  |          |                    Notify                     |
  |          | &lt;---------- 2.05 Content Observe:11 --------- |
  |          |                                               |

</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-example-of-subscribe" class="selfRef">Example of SUBSCRIBE</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="unsubscribe">
<section id="section-4.5">
        <h3 id="name-unsubscribe">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-unsubscribe" class="section-name selfRef">UNSUBSCRIBE</a>
        </h3>
<p id="section-4.5-1">If a CoAP pub/sub Broker allows clients to SUBSCRIBE to topics on the Broker,
it MUST allow Clients to unsubscribe from topics on the Broker using the CoAP
Cancel Observation operation. A CoAP pub/sub Client wishing to unsubscribe
to a topic on a Broker MUST either use CoAP GET with Observe using an Observe
parameter of 1 or send a CoAP Reset message in response to a publish, as
per <span>[<a href="#RFC7641" class="xref">RFC7641</a>]</span>.<a href="#section-4.5-1" class="pilcrow">Â¶</a></p>
<p id="section-4.5-2">The UNSUBSCRIBE operation is specified as follows:<a href="#section-4.5-2" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.5-3">
          <dt id="section-4.5-3.1">Interaction:</dt>
<dd id="section-4.5-3.2">
  Client -&gt; Broker<a href="#section-4.5-3.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.5-3.3">Method:</dt>
<dd id="section-4.5-3.4">
  GET<a href="#section-4.5-3.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.5-3.5">Options:</dt>
<dd id="section-4.5-3.6">
  Observe:1<a href="#section-4.5-3.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.5-3.7">URI Template:</dt>
<dd id="section-4.5-3.8">
  {+ps}/{+topic}{?q*}<a href="#section-4.5-3.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.5-3.9">URI Template Variables:</dt>
<dd id="section-4.5-3.10">
  ps := Pub/sub REST API entry point (optional). The entry point of the pub/sub
REST API, as obtained from discovery, used to discover topics.<a href="#section-4.5-3.10" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.5-3.11"></dt>
<dd id="section-4.5-3.12">topic := The desired topic to return links for (optional).<a href="#section-4.5-3.12" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.5-3.13"></dt>
<dd id="section-4.5-3.14">q := Query Filter (optional). MAY contain a query filter list as per
 <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span> Section 4.1.<a href="#section-4.5-3.14" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.5-4">The following response codes are defined for the UNSUBSCRIBE operation:<a href="#section-4.5-4" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.5-5">
          <dt id="section-4.5-5.1">Success:</dt>
<dd id="section-4.5-5.2">
  2.05 "Content". Successful unsubscribe, current value included<a href="#section-4.5-5.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.5-5.3">Success:</dt>
<dd id="section-4.5-5.4">
  2.07 "No Content". Successful unsubscribe, value not included<a href="#section-4.5-5.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.5-5.5">Failure:</dt>
<dd id="section-4.5-5.6">
  4.00 "Bad Request". Malformed request.<a href="#section-4.5-5.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.5-5.7">Failure:</dt>
<dd id="section-4.5-5.8">
  4.01 "Unauthorized". Authorization failure.<a href="#section-4.5-5.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.5-5.9">Failure:</dt>
<dd id="section-4.5-5.10">
  4.04 "Not Found". Topic does not exist.<a href="#section-4.5-5.10" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.5-6"><a href="#unsubscribe-fig" class="xref">Figure 11</a> shows an example of a client unsubscribe using the
Observe=1 cancellation method.<a href="#section-4.5-6" class="pilcrow">Â¶</a></p>
<span id="name-example-of-unsubscribe"></span><div id="unsubscribe-fig">
<figure id="figure-11">
          <div class="artwork art-text alignCenter" id="section-4.5-7.1">
<pre>
Client                                          Broker
  |                                               |
  | ----- GET /ps/topic1 Observe:1 Token:XX ----&gt; |
  |                                               |
  | &lt;------------- 2.05 Content ----------------- |
  |                                               |

</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-example-of-unsubscribe" class="selfRef">Example of UNSUBSCRIBE</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="read">
<section id="section-4.6">
        <h3 id="name-read">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-read" class="section-name selfRef">READ</a>
        </h3>
<p id="section-4.6-1">A CoAP pub/sub Broker MAY accept Read requests on a topic using the the CoAP
GET method if the content format of the request matches the content format the
topic was created with. The Broker MUST return a response code of "2.05
Content" along with the most recently published value if the topic contains
a valid value and the Broker can supply the requested content format.<a href="#section-4.6-1" class="pilcrow">Â¶</a></p>
<p id="section-4.6-2">If the topic was published with the Max-Age option, the Broker MUST set the 
Max-Age option in the valid response to the amount of time remaining for the 
value to be valid since the last publish operation on that topic.<a href="#section-4.6-2" class="pilcrow">Â¶</a></p>
<p id="section-4.6-3">The Broker MUST return a response code "4.04 Not Found" if the topic does not 
exist or has been removed, or if Max-Age of a previously published 
representation has expired.<a href="#section-4.6-3" class="pilcrow">Â¶</a></p>
<p id="section-4.6-4">If a Topic has been created but not yet published to when a READ to the topic is 
received, the Broker MAY acknowledge and queue the pending READ, and defer the 
response until an initial PUBLISH occurs.<a href="#section-4.6-4" class="pilcrow">Â¶</a></p>
<p id="section-4.6-5">The Broker MUST return a response code "4.15 Unsupported Content Format" if the 
Broker can not return the requested content format.<a href="#section-4.6-5" class="pilcrow">Â¶</a></p>
<p id="section-4.6-6">The READ operation is specified as follows:<a href="#section-4.6-6" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.6-7">
          <dt id="section-4.6-7.1">Interaction:</dt>
<dd id="section-4.6-7.2">
  Client -&gt; Broker<a href="#section-4.6-7.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.6-7.3">Method:</dt>
<dd id="section-4.6-7.4">
  GET<a href="#section-4.6-7.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.6-7.5">URI Template:</dt>
<dd id="section-4.6-7.6">
  {+ps}/{+topic}<a href="#section-4.6-7.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.6-7.7">URI Template Variables:</dt>
<dd id="section-4.6-7.8">
  ps := Pub/sub REST API entry point (optional). The entry point of the pub/sub
REST API, as obtained from discovery, used to discover topics.<a href="#section-4.6-7.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.6-7.9"></dt>
<dd id="section-4.6-7.10">topic := The desired topic to return links for (optional).<a href="#section-4.6-7.10" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.6-8">The following response codes are defined for the READ operation:<a href="#section-4.6-8" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.6-9">
          <dt id="section-4.6-9.1">Success:</dt>
<dd id="section-4.6-9.2">
  2.05 "Content". Successful READ, current value included<a href="#section-4.6-9.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.6-9.3">Failure:</dt>
<dd id="section-4.6-9.4">
  4.00 "Bad Request". Malformed request.<a href="#section-4.6-9.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.6-9.5">Failure:</dt>
<dd id="section-4.6-9.6">
  4.01 "Unauthorized". Authorization failure.<a href="#section-4.6-9.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.6-9.7">Failure:</dt>
<dd id="section-4.6-9.8">
  4.04 "Not Found". Topic does not exist.<a href="#section-4.6-9.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.6-9.9">Failure:</dt>
<dd id="section-4.6-9.10">
  4.15 "Unsupported Content Format". Unsupported content-format.<a href="#section-4.6-9.10" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.6-10"><a href="#read-fig" class="xref">Figure 12</a> shows an example of a successful READ from topic1,
followed by a Publish on the topic, followed at some time later by a
read of the updated value from the recent Publish.<a href="#section-4.6-10" class="pilcrow">Â¶</a></p>
<span id="name-example-of-read"></span><div id="read-fig">
<figure id="figure-12">
          <div class="artwork art-text alignCenter" id="section-4.6-11.1">
<pre>
Client1   Client2                                          Broker
  |          |                     Read                      |
  |          | --------------- GET /ps/topic1 -------------&gt; |
  |          |                                               |
  |          | &lt;---------- 2.05 Content "1007.1"------------ |
  |          |                                               |
  |          |                                               |
  |          |                    Publish                    |
  | ---------|----------- PUT /ps/topic1 "1033.3"  --------&gt; |
  |          |                                               |
  |          |                                               |
  |          |                     Read                      |
  |          | --------------- GET /ps/topic1 -------------&gt; |
  |          |                                               |
  |          | &lt;----------- 2.05 Content "1033.3" ---------- |
  |          |                                               |

</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-example-of-read" class="selfRef">Example of READ</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="remove">
<section id="section-4.7">
        <h3 id="name-remove">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-remove" class="section-name selfRef">REMOVE</a>
        </h3>
<p id="section-4.7-1">A CoAP pub/sub Broker MAY allow clients to remove topics from the Broker
using the CoAP Delete
method on the URI of the topic. The CoAP pub/sub Broker MUST return
"2.02 Deleted" if the removal is successful. The Broker MUST
return the appropriate 4.xx response code indicating the reason for
failure if the topic can not be removed.<a href="#section-4.7-1" class="pilcrow">Â¶</a></p>
<p id="section-4.7-2">When a topic is removed for any reason, the Broker SHOULD remove all of the
observers from the list of observers and return a final 4.04 "Not Found"
response as per <span>[<a href="#RFC7641" class="xref">RFC7641</a>]</span> Section 3.2. If a topic which has sub-topics is
removed, then all of its sub-topics MUST be recursively removed.<a href="#section-4.7-2" class="pilcrow">Â¶</a></p>
<p id="section-4.7-3">The REMOVE operation is specified as follows:<a href="#section-4.7-3" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.7-4">
          <dt id="section-4.7-4.1">Interaction:</dt>
<dd id="section-4.7-4.2">
  Client -&gt; Broker<a href="#section-4.7-4.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.7-4.3">Method:</dt>
<dd id="section-4.7-4.4">
  DELETE<a href="#section-4.7-4.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.7-4.5">URI Template:</dt>
<dd id="section-4.7-4.6">
  {+ps}/{+topic}<a href="#section-4.7-4.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.7-4.7">URI Template Variables:</dt>
<dd id="section-4.7-4.8">
  ps := Pub/sub REST API entry point (optional). The entry point of the pub/sub REST API, as obtained from discovery, used to discover topics.<a href="#section-4.7-4.8" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.7-4.9"></dt>
<dd id="section-4.7-4.10">topic := The desired topic to return links for (optional).<a href="#section-4.7-4.10" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.7-4.11">Content-Format:</dt>
<dd id="section-4.7-4.12">
  None<a href="#section-4.7-4.12" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.7-4.13">Response Payload:</dt>
<dd id="section-4.7-4.14">
  None<a href="#section-4.7-4.14" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.7-5">The following response codes are defined for the REMOVE operation:<a href="#section-4.7-5" class="pilcrow">Â¶</a></p>
<dl class="dlParallel" id="section-4.7-6">
          <dt id="section-4.7-6.1">Success:</dt>
<dd id="section-4.7-6.2">
  2.02 "Deleted". Successful remove<a href="#section-4.7-6.2" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.7-6.3">Failure:</dt>
<dd id="section-4.7-6.4">
  4.00 "Bad Request". Malformed request.<a href="#section-4.7-6.4" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.7-6.5">Failure:</dt>
<dd id="section-4.7-6.6">
  4.01 "Unauthorized". Authorization failure.<a href="#section-4.7-6.6" class="pilcrow">Â¶</a>
</dd>
<dt id="section-4.7-6.7">Failure:</dt>
<dd id="section-4.7-6.8">
  4.04 "Not Found". Topic does not exist.<a href="#section-4.7-6.8" class="pilcrow">Â¶</a>
</dd>
</dl>
<p id="section-4.7-7"><a href="#remove-fig" class="xref">Figure 13</a> shows a successful remove of topic1.<a href="#section-4.7-7" class="pilcrow">Â¶</a></p>
<span id="name-example-of-remove"></span><div id="remove-fig">
<figure id="figure-13">
          <div class="artwork art-text alignCenter" id="section-4.7-8.1">
<pre>
Client                                         Broker
 |                                               |
 | ------------- DELETE /ps/topic1 ------------&gt; |
 |                                               |
 |                                               |
 | &lt;-------------- 2.02 Deleted ---------------- |
 |                                               |

</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-example-of-remove" class="selfRef">Example of REMOVE</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<div id="coap-pubsub-operation-with-resource-directory">
<section id="section-5">
      <h2 id="name-coap-pub-sub-operation-with">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-coap-pub-sub-operation-with" class="section-name selfRef">CoAP Pub/sub Operation with Resource Directory</a>
      </h2>
<p id="section-5-1">A CoAP pub/sub Broker may register the base URI, which is the REST API entry point for a pub/sub service, with a Resource
Directory. A pub/sub Client may use an RD to discover a pub/sub Broker.<a href="#section-5-1" class="pilcrow">Â¶</a></p>
<p id="section-5-2">A CoAP pub/sub Client may register links <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span> with a Resource
Directory to enable discovery of created pub/sub topics. A pub/sub
Client may use an RD to discover pub/sub Topics. A client which
registers pub/sub Topics with an RD MUST use the context relation (con)
<span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span> to indicate that the context of
the registered links is the pub/sub Broker.<a href="#section-5-2" class="pilcrow">Â¶</a></p>
<p id="section-5-3">A CoAP pub/sub Broker may alternatively register links to its topics to
a Resource Directory by triggering the RD to retrieve it's links from
.well-known/core.  In order to use this method, the links must first
be exposed in the .well-known/core of the pub/sub Broker. See
<a href="#discover" class="xref">Section 4.1</a> in this document.<a href="#section-5-3" class="pilcrow">Â¶</a></p>
<p id="section-5-4">The pub/sub Broker triggers the RD to retrieve its links by sending a
POST with an empty payload to the .well-known/core of the Resource
Directory.  The RD server will then retrieve the links from the
.well-known/core of the pub/sub Broker and incorporate them into the
Resource Directory. See <span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span> for
further details.<a href="#section-5-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="sleep-wake-operation">
<section id="section-6">
      <h2 id="name-sleep-wake-operation">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-sleep-wake-operation" class="section-name selfRef">Sleep-Wake Operation</a>
      </h2>
<p id="section-6-1">CoAP pub/sub provides a way for client nodes to sleep between operations,
conserving energy during idle periods. This is made possible by shifting
the server role to the Broker, allowing the Broker to be always-on and respond
to requests from other clients while a particular client is sleeping.<a href="#section-6-1" class="pilcrow">Â¶</a></p>
<p id="section-6-2">For example, the Broker will retain the last state update received from a
sleeping client, in order to supply the most recent state update to other
clients in response to read and subscribe operations.<a href="#section-6-2" class="pilcrow">Â¶</a></p>
<p id="section-6-3">Likewise, the Broker will retain the last state update received on the topic
such that a sleeping client, upon waking, can perform a read operation to
the Broker to update its own state from the most recent system state update.<a href="#section-6-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="sec-flow-control">
<section id="section-7">
      <h2 id="name-simple-flow-control">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-simple-flow-control" class="section-name selfRef">Simple Flow Control</a>
      </h2>
<p id="section-7-1">Since the Broker node has to potentially send a large amount of
notification messages for each publish message and it may be serving a
large amount of subscribers and publishers simultaneously, the Broker
may become overwhelmed if it receives many publish messages to popular
topics in a short period of time.<a href="#section-7-1" class="pilcrow">Â¶</a></p>
<p id="section-7-2">If the Broker is unable to serve a certain client that is sending publish 
messages too fast, the Broker SHOULD respond with Response Code 4.29, "Too Many 
Requests" <span>[<a href="#RFC8516" class="xref">RFC8516</a>]</span> and set the Max-Age Option to indicate the number of 
seconds after which the client can retry. The Broker MAY stop creating 
notifications from the publish messages from this client and to this topic for 
the indicated time.<a href="#section-7-2" class="pilcrow">Â¶</a></p>
<p id="section-7-3">If a client receives the 4.29 Response Code from the Broker for a
publish message to a topic, it MUST NOT send new publish messages to
the Broker on the same topic before the time indicated in Max-Age has
passed.<a href="#section-7-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="SecurityConsiderations">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">CoAP pub/sub re-uses CoAP <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span>, CoRE Resource Directory
<span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span>, and Web Linking <span>[<a href="#RFC5988" class="xref">RFC5988</a>]</span> and
therefore the security considerations of those documents also apply to
this specification. Additionally, a CoAP pub/sub Broker and the clients
SHOULD authenticate each other and enforce access control policies. A
malicious client could subscribe to data it is not authorized to or
mount a denial of service attack against the Broker by publishing a
large number of resources.  The authentication can be performed using
the already standardized DTLS offered mechanisms, such as
certificates. DTLS also allows communication security to be
established to ensure integrity and confidentiality protection of the
data exchanged between these relevant parties. Provisioning the
necessary credentials, trust anchors and authorization policies is
non-trivial and subject of ongoing work.<a href="#section-8-1" class="pilcrow">Â¶</a></p>
<p id="section-8-2">The use of a CoAP pub/sub Broker introduces challenges for the use of
end-to-end security between for example a client device on a sensor
network and a client application running in a cloud-based server
infrastructure since Brokers terminate the exchange. While running
separate DTLS sessions from the client device to the Broker and from
Broker to client application protects confidentially on those paths,
the client device does not know whether the commands coming from the
Broker are actually coming from the client application. Similarly, a
client application requesting data does not know whether the data
originated on the client device. For scenarios where end-to-end
security is desirable the use of application layer security is
unavoidable. Application layer security would then provide a guarantee
to the client device that any request originated at the client
application. Similarly, integrity protected sensor data from a client
device will also provide guarantee to the client application that the
data originated on the client device itself. The protected data can
also be verified by the intermediate Broker ensuring that it
stores/caches correct request/response and no malicious
messages/requests are accepted. The Broker would still be able to
perform aggregation of data/requests collected.<a href="#section-8-2" class="pilcrow">Â¶</a></p>
<p id="section-8-3">Depending on the level of trust users and system designers place in
the CoAP pub/sub Broker, the use of end-to-end object security is
RECOMMENDED as described in <span>[<a href="#I-D.ietf-ace-pubsub-profile" class="xref">I-D.ietf-ace-pubsub-profile</a>]</span>.
An example application that uses the CoAP pub/sub Broker and relies on 
end-to-end object security is described in <span>[<a href="#RFC8387" class="xref">RFC8387</a>]</span>. 
When only end-to-end encryption  is necessary and the CoAP Broker is 
trusted, Payload Only Protection (Mode:PAYL) could be used. 
The Publisher would wrap only the  payload before sending it to 
the Broker and set the option Content-Format to application/smpayl. 
Upon receival, the Broker can read the unencrypted CoAP header 
to forward it to the subscribers.<a href="#section-8-3" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="iana">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-9-1">This document registers one attribute value in the Resource Type (rt=) registry
established with <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span> and appends to the definition of one CoAP Response Code in the CoRE Parameters Registry.<a href="#section-9-1" class="pilcrow">Â¶</a></p>
<div id="resource-type-value-coreps">
<section id="section-9.1">
        <h3 id="name-resource-type-value-coreps">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-resource-type-value-coreps" class="section-name selfRef">Resource Type value 'core.ps'</a>
        </h3>
<ul>
<li id="section-9.1-1.1">Attribute Value: core.ps<a href="#section-9.1-1.1" class="pilcrow">Â¶</a>
</li>
<li id="section-9.1-1.2">Description: <a href="#sec-rest-api" class="xref">Section 4</a> of [[This document]]<a href="#section-9.1-1.2" class="pilcrow">Â¶</a>
</li>
<li id="section-9.1-1.3">Reference: [[This document]]<a href="#section-9.1-1.3" class="pilcrow">Â¶</a>
</li>
<li id="section-9.1-1.4">Notes: None<a href="#section-9.1-1.4" class="pilcrow">Â¶</a>
</li>
</ul>
</section>
</div>
<div id="resource-type-value-corepsdiscover">
<section id="section-9.2">
        <h3 id="name-resource-type-value-corepsd">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-resource-type-value-corepsd" class="section-name selfRef">Resource Type value 'core.ps.discover'</a>
        </h3>
<ul>
<li id="section-9.2-1.1">Attribute Value: core.ps.discover<a href="#section-9.2-1.1" class="pilcrow">Â¶</a>
</li>
<li id="section-9.2-1.2">Description: <a href="#sec-rest-api" class="xref">Section 4</a> of [[This document]]<a href="#section-9.2-1.2" class="pilcrow">Â¶</a>
</li>
<li id="section-9.2-1.3">Reference: [[This document]]<a href="#section-9.2-1.3" class="pilcrow">Â¶</a>
</li>
<li id="section-9.2-1.4">Notes: None<a href="#section-9.2-1.4" class="pilcrow">Â¶</a>
</li>
</ul>
</section>
</div>
</section>
</div>
<div id="acks">
<section id="section-10">
      <h2 id="name-acknowledgements">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-10-1">The authors would like to thank Hannes Tschofenig, Zach Shelby, Mohit Sethi,
Peter van der Stok, Tim Kellogg, Anders Eriksson, Goran Selander, Mikko Majanen,
and Olaf Bergmann for their contributions and reviews.<a href="#section-10-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
<dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dt id="RFC3986">[RFC3986]</dt>
<dd>
<span class="refAuthor">Berners-Lee, T.</span><span class="refAuthor">, Fielding, R.</span><span class="refAuthor">, and L. Masinter</span>, <span class="refTitle">"Uniform Resource Identifier (URI): Generic Syntax"</span>, <span class="seriesInfo">STD 66</span>, <span class="seriesInfo">RFC 3986</span>, <span class="seriesInfo">DOI 10.17487/RFC3986</span>, <time datetime="2005-01">January 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3986">https://www.rfc-editor.org/info/rfc3986</a>&gt;</span>. </dd>
<dt id="RFC6570">[RFC6570]</dt>
<dd>
<span class="refAuthor">Gregorio, J.</span><span class="refAuthor">, Fielding, R.</span><span class="refAuthor">, Hadley, M.</span><span class="refAuthor">, Nottingham, M.</span><span class="refAuthor">, and D. Orchard</span>, <span class="refTitle">"URI Template"</span>, <span class="seriesInfo">RFC 6570</span>, <span class="seriesInfo">DOI 10.17487/RFC6570</span>, <time datetime="2012-03">March 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6570">https://www.rfc-editor.org/info/rfc6570</a>&gt;</span>. </dd>
<dt id="RFC6690">[RFC6690]</dt>
<dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refTitle">"Constrained RESTful Environments (CoRE) Link Format"</span>, <span class="seriesInfo">RFC 6690</span>, <span class="seriesInfo">DOI 10.17487/RFC6690</span>, <time datetime="2012-08">August 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6690">https://www.rfc-editor.org/info/rfc6690</a>&gt;</span>. </dd>
<dt id="RFC7252">[RFC7252]</dt>
<dd>
<span class="refAuthor">Shelby, Z.</span><span class="refAuthor">, Hartke, K.</span><span class="refAuthor">, and C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dt id="RFC7641">[RFC7641]</dt>
<dd>
<span class="refAuthor">Hartke, K.</span>, <span class="refTitle">"Observing Resources in the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7641</span>, <span class="seriesInfo">DOI 10.17487/RFC7641</span>, <time datetime="2015-09">September 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7641">https://www.rfc-editor.org/info/rfc7641</a>&gt;</span>. </dd>
<dt id="RFC8174">[RFC8174]</dt>
<dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dt id="RFC8516">[RFC8516]</dt>
<dd>
<span class="refAuthor">Keranen, A.</span>, <span class="refTitle">""Too Many Requests" Response Code for the Constrained Application Protocol"</span>, <span class="seriesInfo">RFC 8516</span>, <span class="seriesInfo">DOI 10.17487/RFC8516</span>, <time datetime="2019-01">January 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8516">https://www.rfc-editor.org/info/rfc8516</a>&gt;</span>. </dd>
</dl>
</section>
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-ace-pubsub-profile">[I-D.ietf-ace-pubsub-profile]</dt>
<dd>
<span class="refAuthor">Palombini, F.</span>, <span class="refTitle">"Pub-Sub Profile for Authentication and Authorization for Constrained Environments (ACE)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-pubsub-profile-00</span>, <time datetime="2020-01-04">4 January 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ace-pubsub-profile-00.txt">http://www.ietf.org/internet-drafts/draft-ietf-ace-pubsub-profile-00.txt</a>&gt;</span>. </dd>
<dt id="I-D.ietf-core-resource-directory">[I-D.ietf-core-resource-directory]</dt>
<dd>
<span class="refAuthor">Shelby, Z.</span><span class="refAuthor">, Koster, M.</span><span class="refAuthor">, Bormann, C.</span><span class="refAuthor">, Stok, P.</span><span class="refAuthor">, and C. Amsuess</span>, <span class="refTitle">"CoRE Resource Directory"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-resource-directory-23</span>, <time datetime="2019-07-08">8 July 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-core-resource-directory-23.txt">http://www.ietf.org/internet-drafts/draft-ietf-core-resource-directory-23.txt</a>&gt;</span>. </dd>
<dt id="RFC5988">[RFC5988]</dt>
<dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"Web Linking"</span>, <span class="seriesInfo">RFC 5988</span>, <span class="seriesInfo">DOI 10.17487/RFC5988</span>, <time datetime="2010-10">October 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5988">https://www.rfc-editor.org/info/rfc5988</a>&gt;</span>. </dd>
<dt id="RFC8387">[RFC8387]</dt>
<dd>
<span class="refAuthor">Sethi, M.</span><span class="refAuthor">, Arkko, J.</span><span class="refAuthor">, Keranen, A.</span><span class="refAuthor">, and H. Back</span>, <span class="refTitle">"Practical Considerations and Implementation Experiences in Securing Smart Object Networks"</span>, <span class="seriesInfo">RFC 8387</span>, <span class="seriesInfo">DOI 10.17487/RFC8387</span>, <time datetime="2018-05">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8387">https://www.rfc-editor.org/info/rfc8387</a>&gt;</span>. </dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="section-appendix.a">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Michael Koster</span></div>
<div dir="auto" class="left"><span class="org">SmartThings</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:Michael.Koster@smartthings.com" class="email">Michael.Koster@smartthings.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ari Keranen</span></div>
<div dir="auto" class="left"><span class="org">Ericsson</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ari.keranen@ericsson.com" class="email">ari.keranen@ericsson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jaime JimÃ©nez</span></div>
<div dir="auto" class="left"><span class="org">Ericsson</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jaime.jimenez@ericsson.com" class="email">jaime.jimenez@ericsson.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
